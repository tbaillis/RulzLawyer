<!DOCTYPE html>
<html>
<head>
    <title>RulzLawyer System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .console-output { background: #f8f9fa; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üé≤ RulzLawyer System Integration Test</h1>
    <div id="test-results"></div>
    <h2>Console Output</h2>
    <div id="console-output" class="console-output"></div>

    <!-- Load all systems -->
    <script src="code-repository/src/dice-engine.js"></script>
    <script src="code-repository/src/srd-data.js"></script>
    <script src="code-repository/src/spell-manager.js"></script>
    <script src="code-repository/src/equipment-manager.js"></script>
    <script src="code-repository/src/random-tables-index.js"></script>
    <script src="code-repository/src/character-manager.js"></script>
    <script src="code-repository/src/adventure-engine.js"></script>
    <script src="code-repository/src/storage-manager.js"></script>
    <script src="app.js"></script>

    <script>
        // Capture console output
        const originalLog = console.log;
        const consoleDiv = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += args.join(' ') + '<br>';
        };

        // Test results container
        const resultsDiv = document.getElementById('test-results');

        function addTestResult(testName, passed, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${passed ? '‚úÖ' : '‚ùå'} ${testName}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsDiv.appendChild(div);
        }

        // Wait for game engine to initialize
        setTimeout(() => {
            console.log('üß™ Starting comprehensive system tests...');
            
            try {
                // Test 1: Engine initialization
                const engineExists = window.gameEngine !== undefined;
                addTestResult('Game Engine Initialization', engineExists, 
                    engineExists ? 'Engine loaded successfully' : 'Engine not found');

                if (engineExists) {
                    const engine = window.gameEngine;
                    
                    // Test 2: Dice engine
                    try {
                        const roll = engine.diceEngine.roll('1d20');
                        const diceWorking = roll >= 1 && roll <= 20;
                        addTestResult('Dice Engine', diceWorking, 
                            `Rolled 1d20: ${roll}`);
                    } catch (e) {
                        addTestResult('Dice Engine', false, e.message);
                    }

                    // Test 3: Character creation
                    try {
                        const char = engine.characterManager.createCharacter({
                            name: 'Test Wizard',
                            race: 'human',
                            class: 'wizard',
                            level: 1
                        });
                        const charWorking = char && char.name === 'Test Wizard';
                        addTestResult('Character Creation', charWorking, 
                            charWorking ? `Created: ${char.name}, ${char.race} ${char.class} ${char.level}` : 'Failed to create character');
                        
                        if (charWorking) {
                            // Test character stats
                            const hasStats = char.abilities && char.abilities.strength;
                            addTestResult('Character Stats', hasStats, 
                                hasStats ? `STR: ${char.abilities.strength}, HP: ${char.hitPoints.maximum}` : 'Missing ability scores');
                        }
                    } catch (e) {
                        addTestResult('Character Creation', false, e.message);
                    }

                    // Test 4: Spell system
                    try {
                        const spellCount = Object.keys(engine.spellManager.spellDatabase).length;
                        const spellsWorking = spellCount > 0;
                        addTestResult('Spell System', spellsWorking, 
                            `Loaded ${spellCount} spells`);
                    } catch (e) {
                        addTestResult('Spell System', false, e.message);
                    }

                    // Test 5: Equipment system
                    try {
                        const weaponCount = Object.keys(engine.equipmentManager.weapons).length;
                        const equipmentWorking = weaponCount > 0;
                        addTestResult('Equipment System', equipmentWorking, 
                            `Loaded ${weaponCount} weapons`);
                    } catch (e) {
                        addTestResult('Equipment System', false, e.message);
                    }

                    // Test 6: Adventure generation
                    try {
                        const adventure = engine.adventureEngine.generateAdventure({
                            partyLevel: 1,
                            adventureType: 'dungeon'
                        });
                        const adventureWorking = adventure && adventure.description;
                        addTestResult('Adventure Generation', adventureWorking, 
                            adventureWorking ? 'Generated adventure successfully' : 'Failed to generate adventure');
                    } catch (e) {
                        addTestResult('Adventure Generation', false, e.message);
                    }

                    // Test 7: SRD data integration
                    try {
                        const races = window.SRD_DATA?.races;
                        const classes = window.SRD_DATA?.classes;
                        const srdWorking = races && classes && Object.keys(races).length > 0;
                        addTestResult('SRD Data Integration', srdWorking, 
                            srdWorking ? `${Object.keys(races).length} races, ${Object.keys(classes).length} classes` : 'SRD data not loaded');
                    } catch (e) {
                        addTestResult('SRD Data Integration', false, e.message);
                    }

                    console.log('‚úÖ All system tests completed!');
                }
            } catch (error) {
                console.error('Test suite error:', error);
                addTestResult('Test Suite', false, error.message);
            }
        }, 2000);
    </script>
</body>
</html>