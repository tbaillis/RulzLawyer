<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Creation Test - RulzLawyer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #1a1a1a; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #444; background-color: #2d2d2d; }
        .test-result { margin: 10px 0; padding: 10px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 10px 15px; }
        .form-group { margin: 10px 0; }
        .form-input { padding: 8px; margin: 5px 0; width: 200px; }
        .character-display { background-color: #333; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üßô‚Äç‚ôÇÔ∏è Character Creation System Test</h1>
    
    <div class="test-section">
        <h2>Manual Character Creation Test</h2>
        <div class="form-group">
            <label>Character Name:</label><br>
            <input type="text" id="test-name" class="form-input" value="Aragorn" placeholder="Enter character name">
        </div>
        <div class="form-group">
            <label>Race:</label><br>
            <select id="test-race" class="form-input">
                <option value="Human">Human</option>
                <option value="Elf">Elf</option>
                <option value="Dwarf">Dwarf</option>
                <option value="Halfling">Halfling</option>
                <option value="Half-Elf">Half-Elf</option>
                <option value="Half-Orc">Half-Orc</option>
            </select>
        </div>
        <div class="form-group">
            <label>Class:</label><br>
            <select id="test-class" class="form-input">
                <option value="Fighter">Fighter</option>
                <option value="Wizard">Wizard</option>
                <option value="Cleric">Cleric</option>
                <option value="Rogue">Rogue</option>
                <option value="Ranger">Ranger</option>
                <option value="Barbarian">Barbarian</option>
            </select>
        </div>
        <div class="form-group">
            <label>Level:</label><br>
            <input type="number" id="test-level" class="form-input" value="1" min="1" max="20">
        </div>
        <button onclick="testCreateCharacter()" class="action-btn">Create Character</button>
        <button onclick="testListCharacters()" class="action-btn">List Characters</button>
        <button onclick="clearResults()" class="action-btn">Clear Results</button>
        <div id="character-results"></div>
    </div>

    <div class="test-section">
        <h2>Character Update Test</h2>
        <div class="form-group">
            <label>Character ID:</label><br>
            <input type="text" id="update-id" class="form-input" placeholder="Enter character ID">
        </div>
        <div class="form-group">
            <label>New Name:</label><br>
            <input type="text" id="update-name" class="form-input" placeholder="Enter new name">
        </div>
        <button onclick="testUpdateCharacter()" class="action-btn">Update Character</button>
        <div id="update-results"></div>
    </div>

    <div class="test-section">
        <h2>System Integration Test</h2>
        <button onclick="runFullSystemTest()" class="action-btn">Run Full System Test</button>
        <div id="system-results"></div>
    </div>

    <script src="code-repository/src/web-interface.js"></script>
    <script>
        let webInterface = null;

        // Initialize the web interface when page loads
        document.addEventListener('DOMContentLoaded', () => {
            try {
                webInterface = new RulzLawyerWebInterface();
                addResult('system-results', '‚úÖ Web Interface initialized successfully', 'success');
            } catch (error) {
                addResult('system-results', `‚ùå Web Interface initialization failed: ${error.message}`, 'error');
            }
        });

        function addResult(containerId, message, className = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${className}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('character-results').innerHTML = '';
            document.getElementById('update-results').innerHTML = '';
            document.getElementById('system-results').innerHTML = '';
        }

        function testCreateCharacter() {
            const name = document.getElementById('test-name').value;
            const race = document.getElementById('test-race').value;
            const charClass = document.getElementById('test-class').value;
            const level = parseInt(document.getElementById('test-level').value) || 1;

            if (!name) {
                addResult('character-results', '‚ùå Character name is required', 'error');
                return;
            }

            try {
                if (!webInterface) {
                    throw new Error('Web interface not initialized');
                }

                // Test direct character creation
                const characterData = { name, race, class: charClass, level };
                const character = webInterface.gameEngine.characterManager.createCharacter(characterData);
                
                addResult('character-results', `‚úÖ Character created: ${character.name} (${character.race} ${character.class}, Level ${character.level}, HP: ${character.hitPoints.maximum})`, 'success');
                addResult('character-results', `üìù Character ID: ${character.id}`, 'info');

                // Store the ID for update testing
                document.getElementById('update-id').value = character.id;

                // Test character list update
                testListCharacters();

            } catch (error) {
                addResult('character-results', `‚ùå Character creation failed: ${error.message}`, 'error');
                console.error('Character creation error:', error);
            }
        }

        function testListCharacters() {
            try {
                if (!webInterface || !webInterface.gameEngine.storageManager) {
                    throw new Error('Storage manager not available');
                }

                const characters = webInterface.gameEngine.storageManager.getAllCharacters();
                addResult('character-results', `üìã Total characters in storage: ${characters.length}`, 'info');
                
                if (characters.length > 0) {
                    characters.forEach((char, index) => {
                        addResult('character-results', `${index + 1}. ${char.name} (${char.race} ${char.class}, Level ${char.level})`, 'info');
                    });
                } else {
                    addResult('character-results', 'üìã No characters found in storage', 'info');
                }
            } catch (error) {
                addResult('character-results', `‚ùå Failed to list characters: ${error.message}`, 'error');
            }
        }

        function testUpdateCharacter() {
            const id = document.getElementById('update-id').value;
            const newName = document.getElementById('update-name').value;

            if (!id || !newName) {
                addResult('update-results', '‚ùå Both character ID and new name are required', 'error');
                return;
            }

            try {
                // Test character update functionality
                const storageManager = webInterface.gameEngine.storageManager;
                const character = storageManager.getCharacter(id);
                
                if (!character) {
                    addResult('update-results', `‚ùå Character with ID ${id} not found`, 'error');
                    return;
                }

                // Update the character
                character.name = newName;
                storageManager.saveCharacter(character);
                
                addResult('update-results', `‚úÖ Character updated: ${character.name} (ID: ${id})`, 'success');
            } catch (error) {
                addResult('update-results', `‚ùå Character update failed: ${error.message}`, 'error');
                console.error('Character update error:', error);
            }
        }

        function runFullSystemTest() {
            addResult('system-results', 'üß™ Running full system test...', 'info');
            
            // Test 1: Create multiple characters
            const testCharacters = [
                { name: 'Gandalf', race: 'Human', class: 'Wizard', level: 10 },
                { name: 'Legolas', race: 'Elf', class: 'Ranger', level: 8 },
                { name: 'Gimli', race: 'Dwarf', class: 'Fighter', level: 7 }
            ];

            let successCount = 0;
            testCharacters.forEach((charData, index) => {
                try {
                    const character = webInterface.gameEngine.characterManager.createCharacter(charData);
                    addResult('system-results', `‚úÖ Test ${index + 1}: ${character.name} created successfully`, 'success');
                    successCount++;
                } catch (error) {
                    addResult('system-results', `‚ùå Test ${index + 1}: Failed to create ${charData.name}: ${error.message}`, 'error');
                }
            });

            // Summary
            addResult('system-results', `üìä System Test Complete: ${successCount}/${testCharacters.length} characters created successfully`, successCount === testCharacters.length ? 'success' : 'error');
        }
    </script>
</body>
</html>