<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Engine Diagnostic - RulzLawyer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #2c1810;
            color: #f4f1e8;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: rgba(34, 139, 34, 0.2); border: 1px solid #228b22; }
        .error { background: rgba(220, 20, 60, 0.2); border: 1px solid #dc143c; }
        .info { background: rgba(70, 130, 180, 0.2); border: 1px solid #4682b4; }
        pre { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Game Engine Diagnostic</h1>
    <div id="diagnostics">
        <div class="info">Starting diagnostics...</div>
    </div>

    <script>
        const diagnostics = document.getElementById('diagnostics');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            diagnostics.appendChild(div);
        }

        function testModuleLoading() {
            addStatus('üì¶ Testing module loading...', 'info');
            
            // Test each module
            const modules = [
                'src/dice-engine.js',
                'src/character-data-model.js', 
                'src/storage-manager.js',
                'src/character-manager.js',
                'src/random-tables-engine.js',
                'src/adventure-engine.js',
                '../app.js'
            ];

            let loadedCount = 0;
            let totalModules = modules.length;

            modules.forEach((src, index) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = function() {
                    addStatus(`‚úÖ Loaded: ${src}`, 'success');
                    loadedCount++;
                    if (loadedCount === totalModules) {
                        setTimeout(testGameEngine, 500);
                    }
                };
                script.onerror = function() {
                    addStatus(`‚ùå Failed to load: ${src}`, 'error');
                    loadedCount++;
                    if (loadedCount === totalModules) {
                        setTimeout(testGameEngine, 500);
                    }
                };
                document.head.appendChild(script);
            });
        }

        function testGameEngine() {
            addStatus('üéÆ Testing game engine initialization...', 'info');
            
            // Test if classes are available
            const tests = [
                { name: 'DiceEngine', available: typeof DiceEngine !== 'undefined' },
                { name: 'CharacterDataModel', available: typeof CharacterDataModel !== 'undefined' },
                { name: 'StorageManager', available: typeof StorageManager !== 'undefined' },
                { name: 'CharacterManager', available: typeof CharacterManager !== 'undefined' },
                { name: 'RandomTablesEngine', available: typeof RandomTablesEngine !== 'undefined' },
                { name: 'AdventureEngine', available: typeof AdventureEngine !== 'undefined' },
                { name: 'RulzLawyerGameEngine', available: typeof RulzLawyerGameEngine !== 'undefined' }
            ];

            tests.forEach(test => {
                if (test.available) {
                    addStatus(`‚úÖ ${test.name} class available`, 'success');
                } else {
                    addStatus(`‚ùå ${test.name} class not available`, 'error');
                }
            });

            // Test game engine instance
            if (typeof window.gameEngine !== 'undefined') {
                addStatus('‚úÖ window.gameEngine available', 'success');
                
                // Test engine properties
                const engine = window.gameEngine;
                const properties = ['diceEngine', 'characterDataModel', 'storageManager', 'characterManager', 'randomTablesEngine', 'adventureEngine'];
                
                properties.forEach(prop => {
                    if (engine[prop]) {
                        addStatus(`‚úÖ gameEngine.${prop} initialized`, 'success');
                    } else {
                        addStatus(`‚ùå gameEngine.${prop} not initialized`, 'error');
                    }
                });
                
            } else {
                addStatus('‚ùå window.gameEngine not available', 'error');
            }

            // Show available global objects
            const globals = ['diceEngine', 'characterDataModel', 'storageManager', 'characterManager', 'randomTablesEngine', 'adventureEngine'];
            const availableGlobals = globals.filter(name => typeof window[name] !== 'undefined');
            
            if (availableGlobals.length > 0) {
                addStatus(`‚úÖ Available globals: ${availableGlobals.join(', ')}`, 'success');
            } else {
                addStatus('‚ùå No global engine objects available', 'error');
            }

            // Test Adventure Engine functionality
            if (typeof window.adventureEngine !== 'undefined') {
                addStatus('üó∫Ô∏è Testing Adventure Engine functionality...', 'info');
                try {
                    const stats = window.adventureEngine.getStatistics();
                    addStatus(`‚úÖ Adventure Engine stats: <pre>${JSON.stringify(stats, null, 2)}</pre>`, 'success');
                } catch (error) {
                    addStatus(`‚ùå Adventure Engine error: ${error.message}`, 'error');
                }
            }
        }

        // Start diagnostics
        setTimeout(testModuleLoading, 100);
    </script>
</body>
</html>