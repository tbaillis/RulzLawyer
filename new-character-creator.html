<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D&D 3.5 Character Sheet - RulzLawyer</title>
  <style>
    /* EXACT PDF COLOR MATCHING */
    :root {
      /* Main PDF Colors from Images */
      --tan-background: #F4F1E8;
      /* Exact tan from PDF */
      --red-headers: #8B0000;
      /* Dark red section headers */
      --blue-abilities: #4169E1;
      /* Blue ability score boxes */
      --green-skills: #228B22;
      /* Green skills background */
      --white-inputs: #FFFFFF;
      /* White input fields */
      --light-tan: #F8F6F0;
      /* Light tan sections */

      /* Border and Text Colors */
      --black-borders: #000000;
      /* Black table borders */
      --gray-lines: #808080;
      /* Gray divider lines */
      --black-text: #000000;
      /* Main text color */
      --white-text: #FFFFFF;
      /* Text on colored backgrounds */
      --red-text: #8B0000;
      /* Red text accents */

      /* Typography */
      --main-font: 'Arial', sans-serif;
      --bold-font: 'Arial Black', sans-serif;

      /* Spacing */
      --small-padding: 2px 4px;
      --medium-padding: 4px 8px;
      --large-padding: 8px 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--main-font);
      background: var(--tan-background);
      color: var(--black-text);
      font-size: 9px;
      line-height: 1.1;
      padding: 8px;
    }

    /* Tab Navigation */
    .sheet-tabs {
      display: flex;
      margin-bottom: 10px;
      border-bottom: 2px solid var(--black-borders);
      background: var(--light-tan);
    }

    .tab-button {
      background: var(--light-tan);
      border: 1px solid var(--gray-lines);
      border-bottom: none;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: bold;
      font-size: 10px;
      color: var(--black-text);
    }

    .tab-button.active {
      background: var(--red-headers);
      color: var(--white-text);
    }

    .tab-button:hover:not(.active) {
      background: var(--white-inputs);
    }

    /* Page System */
    .page {
      display: none;
      background: var(--tan-background);
      min-height: 1000px;
    }

    .page.active {
      display: block;
    }

    /* Common Table Styles */
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 8px;
    }

    th,
    td {
      border: 1px solid var(--black-borders);
      padding: var(--small-padding);
      text-align: center;
      vertical-align: middle;
    }

    th {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      font-size: 7px;
    }

    /* Input Styles */
    input[type="text"],
    input[type="number"],
    select,
    textarea {
      border: none;
      background: var(--white-inputs);
      font-size: 8px;
      width: 100%;
      padding: 1px 2px;
      font-family: var(--main-font);
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid var(--blue-abilities);
      background: var(--white-inputs);
    }

    /* PAGE 1 - CHARACTER SHEET LAYOUT */
    .character-page {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: auto auto 1fr auto;
      gap: 6px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Character Header Information */
    .char-header {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
      gap: 3px;
      margin-bottom: 6px;
    }

    .header-group {
      display: flex;
      flex-direction: column;
    }

    .header-label {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      font-size: 7px;
      padding: 2px 4px;
      text-align: center;
      border: 1px solid var(--black-borders);
    }

    .header-input {
      border: 1px solid var(--black-borders);
      background: var(--white-inputs);
      padding: 3px;
      text-align: center;
      font-size: 9px;
    }

    /* Character Details Section */
    .char-details {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 3px;
      margin-bottom: 6px;
    }

    /* Ability Scores Section */
    .abilities-section {
      background: var(--light-tan);
      border: 2px solid var(--black-borders);
      padding: 4px;
    }

    .ability-header {
      background: var(--red-headers);
      color: var(--white-text);
      text-align: center;
      font-weight: bold;
      font-size: 9px;
      padding: 3px;
      margin-bottom: 3px;
    }

    .ability-score {
      background: var(--blue-abilities);
      color: var(--white-text);
      border: 1px solid var(--black-borders);
      margin-bottom: 3px;
      font-weight: bold;
    }

    .ability-name {
      font-size: 9px;
      font-weight: bold;
      padding: 2px;
      text-align: center;
      background: var(--blue-abilities);
      color: var(--white-text);
    }

    .ability-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1px;
    }

    .score-box {
      background: var(--white-inputs);
      color: var(--black-text);
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      padding: 6px;
      border: none;
    }

    .modifier-box {
      background: var(--white-inputs);
      color: var(--black-text);
      font-size: 11px;
      font-weight: bold;
      text-align: center;
      padding: 6px;
      border: none;
    }

    .ability-details {
      background: var(--light-tan);
      padding: 2px;
      font-size: 6px;
    }

    .ability-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1px;
      margin: 1px 0;
    }

    .detail-label {
      font-size: 5px;
      font-weight: bold;
      text-align: center;
    }

    .detail-input {
      background: var(--white-inputs);
      font-size: 6px;
      text-align: center;
      border: 1px solid var(--gray-lines);
      padding: 1px;
    }

    /* Combat Stats Section */
    .combat-section {
      background: var(--light-tan);
      border: 2px solid var(--black-borders);
      padding: 4px;
      display: grid;
      gap: 4px;
    }

    /* Armor Class */
    .ac-block {
      border: 1px solid var(--black-borders);
      text-align: center;
    }

    .ac-header {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      padding: 3px;
      font-size: 10px;
    }

    .ac-total {
      background: var(--white-inputs);
      font-size: 20px;
      font-weight: bold;
      padding: 6px;
    }

    .ac-breakdown {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      font-size: 6px;
      gap: 1px;
    }

    .ac-component {
      text-align: center;
      padding: 1px;
    }

    .ac-label {
      font-size: 5px;
      font-weight: bold;
    }

    .ac-value {
      background: var(--white-inputs);
      border: 1px solid var(--gray-lines);
      padding: 2px;
      font-size: 7px;
    }

    /* Hit Points */
    .hp-block {
      border: 1px solid var(--black-borders);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
    }

    .hp-header {
      grid-column: 1 / -1;
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      padding: 2px;
      text-align: center;
      font-size: 8px;
    }

    .hp-field {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2px;
    }

    .hp-label {
      font-size: 6px;
      font-weight: bold;
      margin-bottom: 1px;
    }

    .hp-input {
      background: var(--white-inputs);
      border: 1px solid var(--gray-lines);
      text-align: center;
      font-size: 10px;
      font-weight: bold;
      width: 40px;
      padding: 3px;
    }

    /* Skills Section */
    .skills-section {
      background: var(--green-skills);
      border: 2px solid var(--black-borders);
      color: var(--white-text);
      padding: 2px;
    }

    .skills-header {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      padding: 3px;
      text-align: center;
      font-size: 10px;
      margin-bottom: 2px;
    }

    .skills-table {
      width: 100%;
      background: var(--green-skills);
    }

    .skills-table th {
      background: var(--green-skills);
      color: var(--white-text);
      font-size: 6px;
      padding: 2px 1px;
    }

    .skills-table td {
      background: var(--white-inputs);
      color: var(--black-text);
      padding: 1px;
      font-size: 7px;
    }

    .skill-name {
      text-align: left !important;
      padding-left: 3px;
      font-size: 7px;
    }

    .skill-input {
      width: 100%;
      text-align: center;
      border: none;
      background: transparent;
      font-size: 7px;
    }

    /* Feats Section */
    .feats-section {
      grid-column: 1 / -1;
      border: 2px solid var(--black-borders);
      background: var(--light-tan);
      padding: 4px;
      margin-top: 6px;
    }

    .feats-header {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      padding: 3px;
      text-align: center;
      font-size: 10px;
      margin-bottom: 3px;
    }

    .feats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
    }

    .feat-box {
      border: 1px solid var(--black-borders);
      background: var(--white-inputs);
      padding: 4px;
      min-height: 60px;
    }

    /* Equipment Section */
    .equipment-section {
      grid-column: 1 / -1;
      margin-top: 6px;
    }

    .equipment-header {
      background: var(--red-headers);
      color: var(--white-text);
      font-weight: bold;
      padding: 3px;
      text-align: center;
      font-size: 10px;
      border: 1px solid var(--black-borders);
    }

    .weapons-table {
      width: 100%;
      margin-bottom: 6px;
    }

    .weapons-table th {
      background: var(--red-headers);
      color: var(--white-text);
      font-size: 7px;
    }

    .weapons-table td {
      background: var(--white-inputs);
      padding: 2px;
    }

    /* Responsive Design */
    @media (max-width: 1000px) {
      .character-page {
        grid-template-columns: 1fr;
      }

      .char-header {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media print {
      body {
        background: white;
      }

      .sheet-tabs {
        display: none;
      }

      .page {
        max-width: none;
      }
    }
  </style>
</head>

<body>
  <!-- Tab Navigation -->
  <div class="sheet-tabs">
    <button type="button" class="tab-button active" onclick="showPage(1)">Page 1 - Character</button>
    <button type="button" class="tab-button" onclick="showPage(2)">Page 2 - Equipment</button>
    <button type="button" class="tab-button" onclick="showPage(3)">Page 3 - Spells & Notes</button>
  </div>

  <!-- PAGE 1 - MAIN CHARACTER SHEET -->
  <div id="page1" class="page active">
    <div class="character-page">

      <!-- CHARACTER HEADER -->
      <div class="char-header">
        <div class="header-group">
          <div class="header-label">CHARACTER NAME</div>
          <input type="text" class="header-input" id="characterName" placeholder="Enter character name">
        </div>
        <div class="header-group">
          <div class="header-label">CLASS & LEVEL</div>
          <input type="text" class="header-input" id="classLevel" placeholder="Fighter 1">
        </div>
        <div class="header-group">
          <div class="header-label">RACE</div>
          <input type="text" class="header-input" id="race" placeholder="Human">
        </div>
        <div class="header-group">
          <div class="header-label">ALIGNMENT</div>
          <select class="header-input" id="alignment">
            <option value="">Select</option>
            <option value="LG">Lawful Good</option>
            <option value="NG">Neutral Good</option>
            <option value="CG">Chaotic Good</option>
            <option value="LN">Lawful Neutral</option>
            <option value="N">True Neutral</option>
            <option value="CN">Chaotic Neutral</option>
            <option value="LE">Lawful Evil</option>
            <option value="NE">Neutral Evil</option>
            <option value="CE">Chaotic Evil</option>
          </select>
        </div>
        <div class="header-group">
          <div class="header-label">DEITY</div>
          <input type="text" class="header-input" id="deity" placeholder="None">
        </div>
        <div class="header-group">
          <div class="header-label">SIZE</div>
          <select class="header-input" id="size">
            <option value="M" selected>Medium</option>
            <option value="S">Small</option>
            <option value="L">Large</option>
          </select>
        </div>
        <div class="header-group">
          <div class="header-label">AGE</div>
          <input type="number" class="header-input" id="age" placeholder="25">
        </div>
        <div class="header-group">
          <div class="header-label">GENDER</div>
          <input type="text" class="header-input" id="gender" placeholder="Male">
        </div>
      </div>

      <!-- CHARACTER DETAILS -->
      <div class="char-details">
        <div class="header-group">
          <div class="header-label">HEIGHT</div>
          <input type="text" class="header-input" id="height" placeholder="6'0&quot;">
        </div>
        <div class="header-group">
          <div class="header-label">WEIGHT</div>
          <input type="text" class="header-input" id="weight" placeholder="180 lbs">
        </div>
        <div class="header-group">
          <div class="header-label">EYES</div>
          <input type="text" class="header-input" id="eyes" placeholder="Brown">
        </div>
        <div class="header-group">
          <div class="header-label">HAIR</div>
          <input type="text" class="header-input" id="hair" placeholder="Black">
        </div>
        <div class="header-group">
          <div class="header-label">SKIN</div>
          <input type="text" class="header-input" id="skin" placeholder="Tanned">
        </div>
        <div class="header-group">
          <div class="header-label">HOMELAND</div>
          <input type="text" class="header-input" id="homeland" placeholder="City">
        </div>
        <div class="header-group">
          <div class="header-label">EXPERIENCE POINTS</div>
          <input type="number" class="header-input" id="experience" placeholder="0">
        </div>
        <div class="header-group">
          <div class="header-label">NEXT LEVEL</div>
          <input type="number" class="header-input" id="nextLevel" placeholder="1000">
        </div>
      </div>

      <!-- ABILITY SCORES -->
      <div class="abilities-section">
        <div class="ability-header">ABILITY SCORES</div>

        <!-- STRENGTH -->
        <div class="ability-score">
          <div class="ability-name">STRENGTH</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="str" value="10" min="1" max="30">
            <div class="modifier-box" id="strMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <div class="detail-label">ABILITY<br>MODIFIER</div>
              <div class="detail-label">TEMP<br>ADJUST</div>
              <div class="detail-label">TEMP<br>MODIFIER</div>
            </div>
            <div class="ability-row">
              <input type="number" class="detail-input" id="strAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="strTempAdjust" value="0">
              <input type="number" class="detail-input" id="strTempMod" readonly value="0">
            </div>
          </div>
        </div>

        <!-- DEXTERITY -->
        <div class="ability-score">
          <div class="ability-name">DEXTERITY</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="dex" value="10" min="1" max="30">
            <div class="modifier-box" id="dexMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <input type="number" class="detail-input" id="dexAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="dexTempAdjust" value="0">
              <input type="number" class="detail-input" id="dexTempMod" readonly value="0">
            </div>
          </div>
        </div>

        <!-- CONSTITUTION -->
        <div class="ability-score">
          <div class="ability-name">CONSTITUTION</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="con" value="10" min="1" max="30">
            <div class="modifier-box" id="conMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <input type="number" class="detail-input" id="conAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="conTempAdjust" value="0">
              <input type="number" class="detail-input" id="conTempMod" readonly value="0">
            </div>
          </div>
        </div>

        <!-- INTELLIGENCE -->
        <div class="ability-score">
          <div class="ability-name">INTELLIGENCE</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="int" value="10" min="1" max="30">
            <div class="modifier-box" id="intMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <input type="number" class="detail-input" id="intAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="intTempAdjust" value="0">
              <input type="number" class="detail-input" id="intTempMod" readonly value="0">
            </div>
          </div>
        </div>

        <!-- WISDOM -->
        <div class="ability-score">
          <div class="ability-name">WISDOM</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="wis" value="10" min="1" max="30">
            <div class="modifier-box" id="wisMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <input type="number" class="detail-input" id="wisAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="wisTempAdjust" value="0">
              <input type="number" class="detail-input" id="wisTempMod" readonly value="0">
            </div>
          </div>
        </div>

        <!-- CHARISMA -->
        <div class="ability-score">
          <div class="ability-name">CHARISMA</div>
          <div class="ability-main">
            <input type="number" class="score-box" id="cha" value="10" min="1" max="30">
            <div class="modifier-box" id="chaMod">+0</div>
          </div>
          <div class="ability-details">
            <div class="ability-row">
              <input type="number" class="detail-input" id="chaAbilityMod" readonly value="0">
              <input type="number" class="detail-input" id="chaTempAdjust" value="0">
              <input type="number" class="detail-input" id="chaTempMod" readonly value="0">
            </div>
          </div>
        </div>
      </div>

      <!-- COMBAT SECTION -->
      <div class="combat-section">

        <!-- ARMOR CLASS -->
        <div class="ac-block">
          <div class="ac-header">ARMOR CLASS</div>
          <div class="ac-total" id="totalAC">10</div>
          <div class="ac-breakdown">
            <div class="ac-component">
              <div class="ac-label">10</div>
              <div class="ac-value">BASE</div>
            </div>
            <div class="ac-component">
              <input type="number" class="ac-value" id="armorBonus" value="0">
              <div class="ac-label">ARMOR</div>
            </div>
            <div class="ac-component">
              <input type="number" class="ac-value" id="shieldBonus" value="0">
              <div class="ac-label">SHIELD</div>
            </div>
            <div class="ac-component">
              <div class="ac-value" id="dexBonus">+0</div>
              <div class="ac-label">DEX</div>
            </div>
            <div class="ac-component">
              <input type="number" class="ac-value" id="sizeBonus" value="0">
              <div class="ac-label">SIZE</div>
            </div>
            <div class="ac-component">
              <input type="number" class="ac-value" id="naturalArmor" value="0">
              <div class="ac-label">NATURAL</div>
            </div>
          </div>
        </div>

        <!-- HIT POINTS -->
        <div class="hp-block">
          <div class="hp-header">HIT POINTS</div>
          <div class="hp-field">
            <div class="hp-label">TOTAL</div>
            <input type="number" class="hp-input" id="totalHP" value="8">
          </div>
          <div class="hp-field">
            <div class="hp-label">CURRENT</div>
            <input type="number" class="hp-input" id="currentHP" value="8">
          </div>
        </div>

        <!-- INITIATIVE -->
        <div style="border: 1px solid var(--black-borders);">
          <div class="hp-header">INITIATIVE</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; font-size: 7px; padding: 2px;">
            <div style="text-align: center;">
              <div class="hp-label">TOTAL</div>
              <input type="text" class="detail-input" id="totalInit" readonly
                style="font-size: 10px; font-weight: bold;">
            </div>
            <div style="text-align: center;">
              <div class="hp-label">DEX MOD</div>
              <input type="text" class="detail-input" id="initDex" readonly>
            </div>
            <div style="text-align: center;">
              <div class="hp-label">MISC</div>
              <input type="number" class="detail-input" id="initMisc" value="0">
            </div>
          </div>
        </div>

        <!-- BASE ATTACK BONUS -->
        <div style="border: 1px solid var(--black-borders); text-align: center;">
          <div class="hp-header">BASE ATTACK BONUS</div>
          <input type="text" id="bab" value="+0"
            style="font-size: 12px; font-weight: bold; text-align: center; background: var(--white-inputs); border: none; padding: 6px; width: 100%;">
        </div>

        <!-- SAVING THROWS -->
        <div style="border: 1px solid var(--black-borders);">
          <div class="hp-header">SAVING THROWS</div>
          <div style="padding: 2px;">
            <div
              style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 2px; font-size: 6px; margin-bottom: 2px;">
              <div style="font-weight: bold; text-align: center;"></div>
              <div style="font-weight: bold; text-align: center;">BASE</div>
              <div style="font-weight: bold; text-align: center;">ABILITY</div>
              <div style="font-weight: bold; text-align: center;">MISC</div>
              <div style="font-weight: bold; text-align: center;">TOTAL</div>
            </div>
            <div
              style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 2px; align-items: center; font-size: 7px; margin-bottom: 1px;">
              <div style="font-weight: bold;">FORTITUDE</div>
              <input type="number" class="detail-input" id="fortBase" value="0">
              <input type="number" class="detail-input" id="fortAbility" readonly>
              <input type="number" class="detail-input" id="fortMisc" value="0">
              <input type="number" class="detail-input" id="fortTotal" readonly style="font-weight: bold;">
            </div>
            <div
              style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 2px; align-items: center; font-size: 7px; margin-bottom: 1px;">
              <div style="font-weight: bold;">REFLEX</div>
              <input type="number" class="detail-input" id="refBase" value="0">
              <input type="number" class="detail-input" id="refAbility" readonly>
              <input type="number" class="detail-input" id="refMisc" value="0">
              <input type="number" class="detail-input" id="refTotal" readonly style="font-weight: bold;">
            </div>
            <div
              style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 2px; align-items: center; font-size: 7px;">
              <div style="font-weight: bold;">WILL</div>
              <input type="number" class="detail-input" id="willBase" value="0">
              <input type="number" class="detail-input" id="willAbility" readonly>
              <input type="number" class="detail-input" id="willMisc" value="0">
              <input type="number" class="detail-input" id="willTotal" readonly style="font-weight: bold;">
            </div>
          </div>
        </div>
      </div>

      <!-- SKILLS SECTION -->
      <div class="skills-section">
        <div class="skills-header">SKILLS</div>
        <table class="skills-table">
          <thead>
            <tr>
              <th style="width: 35%;">SKILL NAME</th>
              <th style="width: 8%;">KEY<br>ABILITY</th>
              <th style="width: 10%;">SKILL<br>MODIFIER</th>
              <th style="width: 10%;">ABILITY<br>MODIFIER</th>
              <th style="width: 10%;">RANKS</th>
              <th style="width: 10%;">MISC<br>MODIFIER</th>
              <th style="width: 7%;">✓</th>
            </tr>
          </thead>
          <tbody id="skillsTableBody">
            <!-- Skills populated by JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- FEATS SECTION -->
      <div class="feats-section">
        <div class="feats-header">FEATS & SPECIAL ABILITIES</div>
        <div class="feats-grid">
          <textarea class="feat-box" placeholder="List feats and special abilities here..."></textarea>
          <textarea class="feat-box" placeholder="Additional feats and class features..."></textarea>
        </div>
      </div>

      <!-- EQUIPMENT SECTION -->
      <div class="equipment-section">
        <div class="equipment-header">ATTACKS</div>
        <table class="weapons-table">
          <thead>
            <tr>
              <th style="width: 25%;">WEAPON</th>
              <th style="width: 15%;">ATTACK BONUS</th>
              <th style="width: 15%;">DAMAGE</th>
              <th style="width: 15%;">CRITICAL</th>
              <th style="width: 10%;">RANGE</th>
              <th style="width: 10%;">TYPE</th>
              <th style="width: 10%;">NOTES</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" placeholder="Longsword"></td>
              <td><input type="text" placeholder="+1"></td>
              <td><input type="text" placeholder="1d8+1"></td>
              <td><input type="text" placeholder="19-20/x2"></td>
              <td><input type="text" placeholder="—"></td>
              <td><input type="text" placeholder="S"></td>
              <td><input type="text" placeholder=""></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Longbow"></td>
              <td><input type="text" placeholder="+1"></td>
              <td><input type="text" placeholder="1d8"></td>
              <td><input type="text" placeholder="20/x3"></td>
              <td><input type="text" placeholder="100 ft"></td>
              <td><input type="text" placeholder="P"></td>
              <td><input type="text" placeholder=""></td>
            </tr>
            <tr>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
              <td><input type="text" placeholder=""></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PAGE 2 - EQUIPMENT & INVENTORY -->
  <div id="page2" class="page">
    <div style="text-align: center; padding: 50px; font-size: 16px; color: var(--red-text);">
      <h2>Page 2 - Equipment & Inventory</h2>
      <p style="margin: 20px 0; color: var(--black-text);">Complete equipment lists, armor details, and inventory
        management.</p>
      <p style="color: var(--black-text);">This page will contain:</p>
      <ul style="text-align: left; max-width: 600px; margin: 20px auto; color: var(--black-text);">
        <li>• Detailed equipment lists with weights and costs</li>
        <li>• Armor and shield breakdown tables</li>
        <li>• Inventory management with carrying capacity</li>
        <li>• Magic items and special equipment</li>
        <li>• Money and treasure tracking</li>
      </ul>
    </div>
  </div>

  <!-- PAGE 3 - SPELLS & NOTES -->
  <div id="page3" class="page">
    <div style="padding: 20px;">
      <h2 style="text-align: center; color: var(--red-text); margin-bottom: 30px;">Page 3 - Spells & Character Notes</h2>
      
      <!-- Spell Management Section -->
      <div style="background: white; border: 2px solid var(--black-text); margin-bottom: 20px; padding: 15px;">
        <h3 style="color: var(--red-text); margin-bottom: 15px;">🧙‍♂️ Spell Management</h3>
        
        <!-- Spell Slots Display -->
        <div id="spellSlotsContainer" style="margin-bottom: 20px;">
          <h4 style="color: var(--black-text);">Spells Per Day</h4>
          <div id="spellSlotsDisplay" style="display: flex; flex-wrap: wrap; gap: 15px;">
            <!-- Spell slots will be populated by JavaScript -->
          </div>
        </div>
        
        <!-- Spell Search and Selection -->
        <div style="margin-bottom: 20px;">
          <h4 style="color: var(--black-text);">Available Spells</h4>
          <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="spellSearchInput" placeholder="Search spells..." 
                   style="flex: 1; padding: 5px; border: 1px solid #ccc;">
            <select id="spellClassFilter" style="padding: 5px; border: 1px solid #ccc;">
              <option value="">All Classes</option>
            </select>
            <select id="spellLevelFilter" style="padding: 5px; border: 1px solid #ccc;">
              <option value="">All Levels</option>
              <option value="0">0 (Cantrips)</option>
              <option value="1">1st Level</option>
              <option value="2">2nd Level</option>
              <option value="3">3rd Level</option>
              <option value="4">4th Level</option>
              <option value="5">5th Level</option>
              <option value="6">6th Level</option>
              <option value="7">7th Level</option>
              <option value="8">8th Level</option>
              <option value="9">9th Level</option>
            </select>
            <button onclick="searchSpells()" style="padding: 5px 15px; background: var(--red-text); color: white; border: none;">Search</button>
          </div>
          
          <!-- Spell Results -->
          <div id="spellSearchResults" style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #f9f9f9;">
            <!-- Spell search results will appear here -->
          </div>
        </div>
        
        <!-- Known/Prepared Spells -->
        <div style="margin-bottom: 20px;">
          <h4 style="color: var(--black-text);">Known/Prepared Spells</h4>
          <div id="knownSpellsList" style="border: 1px solid #ccc; padding: 10px; min-height: 150px; background: white;">
            <!-- Known spells will be displayed here -->
          </div>
        </div>
      </div>
      
      <!-- Character Background Section -->
      <div style="background: white; border: 2px solid var(--black-text); margin-bottom: 20px; padding: 15px;">
        <h3 style="color: var(--red-text); margin-bottom: 15px;">📜 Character Background</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label style="font-weight: bold; color: var(--black-text);">Character Backstory:</label>
            <textarea id="characterBackstory" rows="6" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                      placeholder="Write your character's background story..."></textarea>
          </div>
          
          <div>
            <label style="font-weight: bold; color: var(--black-text);">Personality Traits:</label>
            <textarea id="personalityTraits" rows="3" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                      placeholder="Describe personality traits..."></textarea>
            
            <label style="font-weight: bold; color: var(--black-text); margin-top: 10px; display: block;">Ideals:</label>
            <textarea id="characterIdeals" rows="2" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                      placeholder="What drives your character?"></textarea>
          </div>
        </div>
      </div>
      
      <!-- Languages and Proficiencies -->
      <div style="background: white; border: 2px solid var(--black-text); margin-bottom: 20px; padding: 15px;">
        <h3 style="color: var(--red-text); margin-bottom: 15px;">🗣️ Languages & Proficiencies</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label style="font-weight: bold; color: var(--black-text);">Languages Known:</label>
            <textarea id="knownLanguages" rows="4" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                      placeholder="Common, Draconic, Elven..."></textarea>
          </div>
          
          <div>
            <label style="font-weight: bold; color: var(--black-text);">Weapon Proficiencies:</label>
            <textarea id="weaponProficiencies" rows="4" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                      placeholder="Simple weapons, martial weapons..."></textarea>
          </div>
        </div>
      </div>
      
      <!-- Campaign Notes -->
      <div style="background: white; border: 2px solid var(--black-text); margin-bottom: 20px; padding: 15px;">
        <h3 style="color: var(--red-text); margin-bottom: 15px;">📋 Campaign Notes</h3>
        
        <div>
          <label style="font-weight: bold; color: var(--black-text);">Adventure Log & Notes:</label>
          <textarea id="campaignNotes" rows="8" style="width: 100%; padding: 5px; border: 1px solid #ccc; margin-top: 5px;"
                    placeholder="Record important campaign events, NPCs met, quests undertaken..."></textarea>
        </div>
      </div>
      
      <!-- Character Actions -->
      <div style="text-align: center; padding: 20px;">
        <button onclick="saveCharacter()" style="background: var(--red-text); color: white; border: none; padding: 12px 24px; font-size: 16px; margin: 0 10px; cursor: pointer;">
          💾 Save Character
        </button>
        <button onclick="loadCharacter()" style="background: #666; color: white; border: none; padding: 12px 24px; font-size: 16px; margin: 0 10px; cursor: pointer;">
          📁 Load Character
        </button>
        <button onclick="exportCharacterPDF()" style="background: #008000; color: white; border: none; padding: 12px 24px; font-size: 16px; margin: 0 10px; cursor: pointer;">
          📄 Export PDF
        </button>
      </div>
    </div>
  </div>

  <script src="code-repository/src/dice-engine.js"></script>
  <script src="code-repository/src/random-tables-engine.js"></script>
  <script src="code-repository/src/system-integration.js"></script>
  <script src="code-repository/src/enhanced-character-engine.js"></script>
  
  <script>
    // Initialize enhanced character engine with full D&D 3.5 system
    let characterEngine = null;
    
    // Initialize the complete character system
    async function initializeCharacterSystem() {
      try {
        console.log('🎲 Starting RulzLawyer Character System...');
        
        // Initialize the enhanced character engine
        characterEngine = window.rulzLawyerEngine;
        await characterEngine.initialize();
        
        // Populate dropdowns with D&D 3.5 data
        await populateDropdowns();
        
        console.log('✅ RulzLawyer Character System ready!');
        
      } catch (error) {
        console.error('❌ Failed to initialize character system:', error);
        // Show user-friendly error
        alert('Failed to initialize character system. Please refresh and try again.');
      }
    }
    
    // Populate dropdowns with actual D&D 3.5 data
    async function populateDropdowns() {
      if (!characterEngine || !characterEngine.dataManager) return;
      
      try {
        // Populate race dropdown
        const races = characterEngine.dataManager.getRaces();
        const raceSelect = document.getElementById('race');
        if (raceSelect && races) {
          raceSelect.innerHTML = '<option value="">Choose Race</option>';
          races.forEach(race => {
            const option = document.createElement('option');
            option.value = race.name;
            option.textContent = race.name;
            raceSelect.appendChild(option);
          });
        }
        
        // Populate class dropdown
        const classes = characterEngine.dataManager.getClasses();
        const classSelect = document.getElementById('classLevel');
        if (classSelect && classes) {
          classSelect.innerHTML = '<option value="">Choose Class & Level</option>';
          classes.forEach(classData => {
            for (let level = 1; level <= 20; level++) {
              const option = document.createElement('option');
              option.value = `${classData.name} ${level}`;
              option.textContent = `${classData.name} ${level}`;
              classSelect.appendChild(option);
            }
          });
        }
        
        // Populate spell class filter
        const spellClassFilter = document.getElementById('spellClassFilter');
        if (spellClassFilter && classes) {
          spellClassFilter.innerHTML = '<option value="">All Classes</option>';
          classes.forEach(classData => {
            if (classData.spellcasting || classData.spell_save_dc_ability) {
              const option = document.createElement('option');
              option.value = classData.name;
              option.textContent = classData.name;
              spellClassFilter.appendChild(option);
            }
          });
        }
        
        // Update spell slots display
        setTimeout(() => updateSpellSlotsDisplay(), 100);
        
        console.log('✅ Dropdowns populated with D&D 3.5 data');
        
      } catch (error) {
        console.error('❌ Failed to populate dropdowns:', error);
      }
    }

    // Tab Navigation Function
    function showPage(pageNum) {
      // Hide all pages and deactivate all tabs
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

      // Show selected page and activate corresponding tab
      document.getElementById('page' + pageNum).classList.add('active');
      document.querySelectorAll('.tab-button')[pageNum - 1].classList.add('active');
    }

    // D&D 3.5 Complete Skills List
    const DND_35_SKILLS = [
      { name: 'Appraise', key: 'Int', trainedOnly: false },
      { name: 'Balance', key: 'Dex', trainedOnly: false },
      { name: 'Bluff', key: 'Cha', trainedOnly: false },
      { name: 'Climb', key: 'Str', trainedOnly: false },
      { name: 'Concentration', key: 'Con', trainedOnly: false },
      { name: 'Craft (Alchemy)', key: 'Int', trainedOnly: false },
      { name: 'Craft (Armorsmithing)', key: 'Int', trainedOnly: false },
      { name: 'Craft (Bowmaking)', key: 'Int', trainedOnly: false },
      { name: 'Craft (Weaponsmithing)', key: 'Int', trainedOnly: false },
      { name: 'Decipher Script', key: 'Int', trainedOnly: true },
      { name: 'Diplomacy', key: 'Cha', trainedOnly: false },
      { name: 'Disable Device', key: 'Int', trainedOnly: true },
      { name: 'Disguise', key: 'Cha', trainedOnly: false },
      { name: 'Escape Artist', key: 'Dex', trainedOnly: false },
      { name: 'Forgery', key: 'Int', trainedOnly: false },
      { name: 'Gather Information', key: 'Cha', trainedOnly: false },
      { name: 'Handle Animal', key: 'Cha', trainedOnly: true },
      { name: 'Heal', key: 'Wis', trainedOnly: false },
      { name: 'Hide', key: 'Dex', trainedOnly: false },
      { name: 'Intimidate', key: 'Cha', trainedOnly: false },
      { name: 'Jump', key: 'Str', trainedOnly: false },
      { name: 'Knowledge (Arcana)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Architecture)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Dungeoneering)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Geography)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (History)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Local)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Nature)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Nobility)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Planes)', key: 'Int', trainedOnly: true },
      { name: 'Knowledge (Religion)', key: 'Int', trainedOnly: true },
      { name: 'Listen', key: 'Wis', trainedOnly: false },
      { name: 'Move Silently', key: 'Dex', trainedOnly: false },
      { name: 'Open Lock', key: 'Dex', trainedOnly: true },
      { name: 'Perform (Act)', key: 'Cha', trainedOnly: false },
      { name: 'Perform (Dance)', key: 'Cha', trainedOnly: false },
      { name: 'Perform (Oratory)', key: 'Cha', trainedOnly: false },
      { name: 'Perform (Sing)', key: 'Cha', trainedOnly: false },
      { name: 'Profession (Soldier)', key: 'Wis', trainedOnly: true },
      { name: 'Ride', key: 'Dex', trainedOnly: false },
      { name: 'Search', key: 'Int', trainedOnly: false },
      { name: 'Sense Motive', key: 'Wis', trainedOnly: false },
      { name: 'Sleight of Hand', key: 'Dex', trainedOnly: true },
      { name: 'Speak Language', key: 'None', trainedOnly: true },
      { name: 'Spellcraft', key: 'Int', trainedOnly: true },
      { name: 'Spot', key: 'Wis', trainedOnly: false },
      { name: 'Survival', key: 'Wis', trainedOnly: false },
      { name: 'Swim', key: 'Str', trainedOnly: false },
      { name: 'Tumble', key: 'Dex', trainedOnly: true },
      { name: 'Use Magic Device', key: 'Cha', trainedOnly: true },
      { name: 'Use Rope', key: 'Dex', trainedOnly: false }
    ];

    // Calculate D&D 3.5 Ability Modifier
    function calculateModifier(score) {
      return Math.floor((score - 10) / 2);
    }

    // Update All Character Statistics with Enhanced D&D 3.5 System
    function updateCharacterStats() {
      // Try to use enhanced character engine if available
      if (characterEngine && characterEngine.isInitialized) {
        updateStatsWithEnhancedEngine();
      } else {
        // Fallback to legacy calculation system
        updateStatsLegacy();
      }
    }
    
    // Enhanced stats update using the D&D 3.5 system
    function updateStatsWithEnhancedEngine() {
      try {
        // Get current character from the engine
        const character = characterEngine.getCharacter();
        if (!character) return;
        
        // Update basic ability score calculations
        const abilities = ['str', 'dex', 'con', 'int', 'wis', 'cha'];
        abilities.forEach(ability => {
          const scoreInput = document.getElementById(ability);
          const modDisplay = document.getElementById(ability + 'Mod');
          const abilityModInput = document.getElementById(ability + 'AbilityMod');
          const tempAdjustInput = document.getElementById(ability + 'TempAdjust');
          const tempModInput = document.getElementById(ability + 'TempMod');

          if (scoreInput && modDisplay) {
            const score = parseInt(scoreInput.value) || 10;
            const tempAdjust = parseInt(tempAdjustInput?.value) || 0;
            
            // Use the calculation engine for accurate D&D 3.5 modifiers
            const modifier = characterEngine.calculationEngine.calculateAbilityModifier(score);
            const tempModifier = characterEngine.calculationEngine.calculateAbilityModifier(score + tempAdjust);

            // Update main modifier display
            modDisplay.textContent = (modifier >= 0 ? '+' : '') + modifier;

            // Update detail fields
            if (abilityModInput) abilityModInput.value = modifier;
            if (tempModInput) tempModInput.value = tempModifier;
          }
        });

        // Update derived statistics using the enhanced system
        updateArmorClassEnhanced();
        updateInitiativeEnhanced();
        updateSavingThrowsEnhanced();
        updateSkills();
        
      } catch (error) {
        console.error('❌ Enhanced stats update failed:', error);
        // Fallback to legacy system
        updateStatsLegacy();
      }
    }
    
    // Legacy stats update (original system)
    function updateStatsLegacy() {
      // Update ability modifiers for all abilities
      const abilities = ['str', 'dex', 'con', 'int', 'wis', 'cha'];

      abilities.forEach(ability => {
        const scoreInput = document.getElementById(ability);
        const modDisplay = document.getElementById(ability + 'Mod');
        const abilityModInput = document.getElementById(ability + 'AbilityMod');
        const tempAdjustInput = document.getElementById(ability + 'TempAdjust');
        const tempModInput = document.getElementById(ability + 'TempMod');

        if (scoreInput && modDisplay) {
          const score = parseInt(scoreInput.value) || 10;
          const tempAdjust = parseInt(tempAdjustInput?.value) || 0;
          const modifier = calculateModifier(score);
          const tempModifier = calculateModifier(score + tempAdjust);

          // Update main modifier display
          modDisplay.textContent = (modifier >= 0 ? '+' : '') + modifier;

          // Update detail fields
          if (abilityModInput) abilityModInput.value = modifier;
          if (tempModInput) tempModInput.value = tempModifier;
        }
      });

      // Update derived statistics
      updateArmorClass();
      updateInitiative();
      updateSavingThrows();
      updateSkills();
    }

    // Update Armor Class
    function updateArmorClass() {
      const base = 10;
      const armorBonus = parseInt(document.getElementById('armorBonus')?.value) || 0;
      const shieldBonus = parseInt(document.getElementById('shieldBonus')?.value) || 0;
      const dexMod = calculateModifier(parseInt(document.getElementById('dex')?.value) || 10);
      const sizeBonus = parseInt(document.getElementById('sizeBonus')?.value) || 0;
      const naturalArmor = parseInt(document.getElementById('naturalArmor')?.value) || 0;

      const totalAC = base + armorBonus + shieldBonus + dexMod + sizeBonus + naturalArmor;

      const totalACElement = document.getElementById('totalAC');
      const dexBonusElement = document.getElementById('dexBonus');

      if (totalACElement) totalACElement.textContent = totalAC;
      if (dexBonusElement) dexBonusElement.textContent = (dexMod >= 0 ? '+' : '') + dexMod;
    }
    
    // Enhanced Armor Class calculation using D&D 3.5 system
    function updateArmorClassEnhanced() {
      try {
        if (!characterEngine || !characterEngine.isInitialized) {
          updateArmorClass();
          return;
        }
        
        const character = characterEngine.getCharacter();
        if (!character || !character.armorClass) {
          updateArmorClass();
          return;
        }
        
        // Use the enhanced AC calculation from the D&D 3.5 system
        const totalAC = character.armorClass.total;
        const dexMod = character.abilityModifiers.dexterity;
        
        const totalACElement = document.getElementById('totalAC');
        const dexBonusElement = document.getElementById('dexBonus');

        if (totalACElement) totalACElement.textContent = totalAC;
        if (dexBonusElement) dexBonusElement.textContent = (dexMod >= 0 ? '+' : '') + dexMod;
        
      } catch (error) {
        console.error('❌ Enhanced AC calculation failed:', error);
        updateArmorClass();
      }
    }

    // Update Initiative
    function updateInitiative() {
      const dexMod = calculateModifier(parseInt(document.getElementById('dex')?.value) || 10);
      const initMisc = parseInt(document.getElementById('initMisc')?.value) || 0;
      const totalInit = dexMod + initMisc;

      const totalInitElement = document.getElementById('totalInit');
      const initDexElement = document.getElementById('initDex');

      if (totalInitElement) totalInitElement.value = (totalInit >= 0 ? '+' : '') + totalInit;
      if (initDexElement) initDexElement.value = (dexMod >= 0 ? '+' : '') + dexMod;
    }
    
    // Enhanced Initiative calculation using D&D 3.5 system
    function updateInitiativeEnhanced() {
      try {
        if (!characterEngine || !characterEngine.isInitialized) {
          updateInitiative();
          return;
        }
        
        const character = characterEngine.getCharacter();
        if (!character) {
          updateInitiative();
          return;
        }
        
        const dexMod = character.abilityModifiers.dexterity;
        const initMisc = parseInt(document.getElementById('initMisc')?.value) || 0;
        const totalInit = dexMod + initMisc;

        const totalInitElement = document.getElementById('totalInit');
        const initDexElement = document.getElementById('initDex');

        if (totalInitElement) totalInitElement.value = (totalInit >= 0 ? '+' : '') + totalInit;
        if (initDexElement) initDexElement.value = (dexMod >= 0 ? '+' : '') + dexMod;
        
      } catch (error) {
        console.error('❌ Enhanced initiative calculation failed:', error);
        updateInitiative();
      }
    }

    // Update Saving Throws
    function updateSavingThrows() {
      const conMod = calculateModifier(parseInt(document.getElementById('con')?.value) || 10);
      const dexMod = calculateModifier(parseInt(document.getElementById('dex')?.value) || 10);
      const wisMod = calculateModifier(parseInt(document.getElementById('wis')?.value) || 10);

      // Fortitude (Constitution)
      const fortBase = parseInt(document.getElementById('fortBase')?.value) || 0;
      const fortMisc = parseInt(document.getElementById('fortMisc')?.value) || 0;
      const fortTotal = fortBase + conMod + fortMisc;

      const fortAbilityElement = document.getElementById('fortAbility');
      const fortTotalElement = document.getElementById('fortTotal');
      if (fortAbilityElement) fortAbilityElement.value = conMod;
      if (fortTotalElement) fortTotalElement.value = fortTotal;

      // Reflex (Dexterity)
      const refBase = parseInt(document.getElementById('refBase')?.value) || 0;
      const refMisc = parseInt(document.getElementById('refMisc')?.value) || 0;
      const refTotal = refBase + dexMod + refMisc;

      const refAbilityElement = document.getElementById('refAbility');
      const refTotalElement = document.getElementById('refTotal');
      if (refAbilityElement) refAbilityElement.value = dexMod;
      if (refTotalElement) refTotalElement.value = refTotal;

      // Will (Wisdom)
      const willBase = parseInt(document.getElementById('willBase')?.value) || 0;
      const willMisc = parseInt(document.getElementById('willMisc')?.value) || 0;
      const willTotal = willBase + wisMod + willMisc;

      const willAbilityElement = document.getElementById('willAbility');
      const willTotalElement = document.getElementById('willTotal');
      if (willAbilityElement) willAbilityElement.value = wisMod;
      if (willTotalElement) willTotalElement.value = willTotal;
    }
    
    // Enhanced Saving Throws calculation using D&D 3.5 system
    function updateSavingThrowsEnhanced() {
      try {
        if (!characterEngine || !characterEngine.isInitialized) {
          updateSavingThrows();
          return;
        }
        
        const character = characterEngine.getCharacter();
        if (!character || !character.savingThrows) {
          updateSavingThrows();
          return;
        }
        
        // Use enhanced saving throws from the D&D 3.5 system
        const saves = character.savingThrows;
        const abilityMods = character.abilityModifiers;
        
        // Update Fortitude
        const fortBase = parseInt(document.getElementById('fortBase')?.value) || 0;
        const fortMisc = parseInt(document.getElementById('fortMisc')?.value) || 0;
        const fortTotal = saves.fortitude || (fortBase + abilityMods.constitution + fortMisc);
        
        const fortAbilityElement = document.getElementById('fortAbility');
        const fortTotalElement = document.getElementById('fortTotal');
        if (fortAbilityElement) fortAbilityElement.value = abilityMods.constitution;
        if (fortTotalElement) fortTotalElement.value = fortTotal;

        // Update Reflex
        const refBase = parseInt(document.getElementById('refBase')?.value) || 0;
        const refMisc = parseInt(document.getElementById('refMisc')?.value) || 0;
        const refTotal = saves.reflex || (refBase + abilityMods.dexterity + refMisc);
        
        const refAbilityElement = document.getElementById('refAbility');
        const refTotalElement = document.getElementById('refTotal');
        if (refAbilityElement) refAbilityElement.value = abilityMods.dexterity;
        if (refTotalElement) refTotalElement.value = refTotal;

        // Update Will
        const willBase = parseInt(document.getElementById('willBase')?.value) || 0;
        const willMisc = parseInt(document.getElementById('willMisc')?.value) || 0;
        const willTotal = saves.will || (willBase + abilityMods.wisdom + willMisc);
        
        const willAbilityElement = document.getElementById('willAbility');
        const willTotalElement = document.getElementById('willTotal');
        if (willAbilityElement) willAbilityElement.value = abilityMods.wisdom;
        if (willTotalElement) willTotalElement.value = willTotal;
        
      } catch (error) {
        console.error('❌ Enhanced saving throws calculation failed:', error);
        updateSavingThrows();
      }
    }

    // Populate Skills Table
    function populateSkills() {
      const tbody = document.getElementById('skillsTableBody');
      if (!tbody) return;

      tbody.innerHTML = '';

      DND_35_SKILLS.forEach((skill, index) => {
        const row = document.createElement('tr');

        row.innerHTML = `
                    <td class="skill-name">${skill.name}</td>
                    <td>${skill.key}</td>
                    <td><input type="number" class="skill-input" id="skillMod${index}" readonly></td>
                    <td><input type="number" class="skill-input" id="skillAbility${index}" readonly></td>
                    <td><input type="number" class="skill-input" id="skillRanks${index}" value="0" min="0" max="23"></td>
                    <td><input type="number" class="skill-input" id="skillMisc${index}" value="0"></td>
                    <td><input type="checkbox" id="skillClass${index}"></td>
                `;

        tbody.appendChild(row);

        // Add event listeners for real-time skill updates
        const ranksInput = document.getElementById(`skillRanks${index}`);
        const miscInput = document.getElementById(`skillMisc${index}`);
        const classInput = document.getElementById(`skillClass${index}`);

        if (ranksInput) ranksInput.addEventListener('input', updateSkills);
        if (miscInput) miscInput.addEventListener('input', updateSkills);
        if (classInput) classInput.addEventListener('change', updateSkills);
      });
    }

    // Update Skill Calculations
    function updateSkills() {
      DND_35_SKILLS.forEach((skill, index) => {
        const keyAbility = skill.key.toLowerCase();
        let abilityMod = 0;

        // Get ability modifier (skip for special skills like Speak Language)
        if (keyAbility !== 'none') {
          const abilityScore = parseInt(document.getElementById(keyAbility)?.value) || 10;
          abilityMod = calculateModifier(abilityScore);
        }

        const ranks = parseInt(document.getElementById(`skillRanks${index}`)?.value) || 0;
        const misc = parseInt(document.getElementById(`skillMisc${index}`)?.value) || 0;
        const isClassSkill = document.getElementById(`skillClass${index}`)?.checked || false;

        // Calculate class skill bonus (+3 if you have ranks and it's a class skill)
        const classBonus = (isClassSkill && ranks > 0) ? 3 : 0;

        // Calculate total modifier
        const totalMod = abilityMod + ranks + misc + classBonus;

        // Update display fields
        const abilityElement = document.getElementById(`skillAbility${index}`);
        const modElement = document.getElementById(`skillMod${index}`);

        if (abilityElement) abilityElement.value = abilityMod;
        if (modElement) modElement.value = totalMod;
      });
    }

    // Initialize Character Sheet
    function initializeCharacterSheet() {
      console.log('📋 Initializing character sheet with enhanced D&D 3.5 system...');
      
      // Initialize the enhanced character system first
      initializeCharacterSystem();
      
      // Populate skills table
      populateSkills();

      // Update all statistics
      updateCharacterStats();

      // Add event listeners to ability scores
      const abilities = ['str', 'dex', 'con', 'int', 'wis', 'cha'];
      abilities.forEach(ability => {
        const scoreInput = document.getElementById(ability);
        const tempAdjustInput = document.getElementById(ability + 'TempAdjust');

        if (scoreInput) {
          scoreInput.addEventListener('input', updateCharacterStats);
        }
        if (tempAdjustInput) {
          tempAdjustInput.addEventListener('input', updateCharacterStats);
        }
      });

      // Add event listeners to AC components
      const acInputs = ['armorBonus', 'shieldBonus', 'sizeBonus', 'naturalArmor'];
      acInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('input', updateArmorClass);
        }
      });

      // Add event listeners to saving throws
      const saveInputs = ['fortBase', 'fortMisc', 'refBase', 'refMisc', 'willBase', 'willMisc'];
      saveInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('input', updateSavingThrows);
        }
      });

      // Add event listener to initiative misc
      const initMisc = document.getElementById('initMisc');
      if (initMisc) {
        initMisc.addEventListener('input', updateInitiative);
      }
      
      console.log('✅ Character sheet initialized');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initializeCharacterSheet);

    // ======= ENHANCED SPELL MANAGEMENT FUNCTIONS =======
    
    // Update spell slots display
    function updateSpellSlotsDisplay() {
      if (!characterEngine || !characterEngine.isInitialized) return;
      
      try {
        const spellSlotsDisplay = document.getElementById('spellSlotsDisplay');
        if (!spellSlotsDisplay) return;
        
        const character = characterEngine.getCharacter();
        const spellSlots = characterEngine.spellManager.calculateSpellSlots(character);
        
        spellSlotsDisplay.innerHTML = '';
        
        for (const className in spellSlots) {
          const classSlots = spellSlots[className];
          const classDiv = document.createElement('div');
          classDiv.style.cssText = 'border: 1px solid #ccc; padding: 10px; background: #f9f9f9; min-width: 150px;';
          
          let slotsHTML = `<h5 style="margin: 0 0 10px 0; color: var(--red-text);">${className}</h5>`;
          
          for (let level = 0; level <= 9; level++) {
            if (classSlots[level] && classSlots[level] > 0) {
              slotsHTML += `<div>Level ${level}: ${classSlots[level]} slots</div>`;
            }
          }
          
          classDiv.innerHTML = slotsHTML;
          spellSlotsDisplay.appendChild(classDiv);
        }
        
      } catch (error) {
        console.error('❌ Failed to update spell slots display:', error);
      }
    }
    
    // Search spells with filters
    function searchSpells() {
      if (!characterEngine || !characterEngine.spellManager) return;
      
      try {
        const searchTerm = document.getElementById('spellSearchInput')?.value || '';
        const classFilter = document.getElementById('spellClassFilter')?.value || '';
        const levelFilter = document.getElementById('spellLevelFilter')?.value || '';
        
        let spells = characterEngine.spellManager.getAllSpells();
        
        // Apply search term filter
        if (searchTerm) {
          spells = characterEngine.spellManager.searchSpells(searchTerm);
        }
        
        // Apply class filter
        if (classFilter) {
          spells = spells.filter(spell => 
            spell.level && spell.level[classFilter] !== undefined
          );
        }
        
        // Apply level filter
        if (levelFilter) {
          const level = parseInt(levelFilter);
          spells = spells.filter(spell => {
            if (!spell.level) return false;
            return Object.values(spell.level).includes(level);
          });
        }
        
        // Display results
        displaySpellSearchResults(spells);
        
      } catch (error) {
        console.error('❌ Spell search failed:', error);
      }
    }
    
    // Display spell search results
    function displaySpellSearchResults(spells) {
      const resultsContainer = document.getElementById('spellSearchResults');
      if (!resultsContainer) return;
      
      resultsContainer.innerHTML = '';
      
      if (spells.length === 0) {
        resultsContainer.innerHTML = '<p style="color: #666;">No spells found matching your criteria.</p>';
        return;
      }
      
      spells.forEach(spell => {
        const spellDiv = document.createElement('div');
        spellDiv.style.cssText = 'border-bottom: 1px solid #eee; padding: 10px; cursor: pointer; background: white; margin-bottom: 5px;';
        spellDiv.onclick = () => showSpellDetails(spell);
        
        let levelInfo = '';
        if (spell.level) {
          const levels = Object.entries(spell.level).map(([cls, lvl]) => `${cls} ${lvl}`).join(', ');
          levelInfo = ` (${levels})`;
        }
        
        spellDiv.innerHTML = `
          <strong>${spell.name}</strong>${levelInfo}
          <br><small style="color: #666;">${spell.school || 'Unknown School'}</small>
          <br><small style="color: #888;">${(spell.description || '').substring(0, 100)}...</small>
        `;
        
        resultsContainer.appendChild(spellDiv);
      });
    }
    
    // Show spell details
    function showSpellDetails(spell) {
      let details = `=== ${spell.name} ===\\n`;
      if (spell.level) {
        const levels = Object.entries(spell.level).map(([cls, lvl]) => `${cls} ${lvl}`).join(', ');
        details += `Level: ${levels}\\n`;
      }
      if (spell.school) details += `School: ${spell.school}\\n`;
      if (spell.components) details += `Components: ${spell.components}\\n`;
      if (spell.casting_time) details += `Casting Time: ${spell.casting_time}\\n`;
      if (spell.range) details += `Range: ${spell.range}\\n`;
      if (spell.duration) details += `Duration: ${spell.duration}\\n`;
      if (spell.description) details += `\\nDescription: ${spell.description}`;
      
      alert(details);
    }
    
    // ======= CHARACTER MANAGEMENT FUNCTIONS =======
    
    // Save character to local storage
    function saveCharacter() {
      if (!characterEngine) {
        alert('Character system not initialized');
        return;
      }
      
      try {
        const character = characterEngine.getCharacter();
        
        // Add spell and background data
        const fullCharacterData = {
          ...character,
          backstory: document.getElementById('characterBackstory')?.value || '',
          personalityTraits: document.getElementById('personalityTraits')?.value || '',
          ideals: document.getElementById('characterIdeals')?.value || '',
          languages: document.getElementById('knownLanguages')?.value || '',
          weaponProficiencies: document.getElementById('weaponProficiencies')?.value || '',
          campaignNotes: document.getElementById('campaignNotes')?.value || '',
          savedDate: new Date().toISOString()
        };
        
        const characterName = fullCharacterData.name || 'Unnamed Character';
        const saveKey = `rulzlawyer_character_${characterName.replace(/[^a-zA-Z0-9]/g, '_')}`;
        
        localStorage.setItem(saveKey, JSON.stringify(fullCharacterData));
        localStorage.setItem('rulzlawyer_last_character', saveKey);
        
        alert(`Character "${characterName}" saved successfully!`);
        
      } catch (error) {
        console.error('❌ Failed to save character:', error);
        alert('Failed to save character. Please try again.');
      }
    }
    
    // Load character from local storage
    function loadCharacter() {
      try {
        const savedCharacters = [];
        
        // Find all saved characters
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('rulzlawyer_character_')) {
            const data = localStorage.getItem(key);
            const character = JSON.parse(data);
            savedCharacters.push({ key, character });
          }
        }
        
        if (savedCharacters.length === 0) {
          alert('No saved characters found.');
          return;
        }
        
        // Create selection dialog
        let selection = 'Select a character to load:\\n\\n';
        savedCharacters.forEach((item, index) => {
          const name = item.character.name || 'Unnamed Character';
          const date = item.character.savedDate ? new Date(item.character.savedDate).toLocaleDateString() : 'Unknown date';
          selection += `${index + 1}. ${name} (${date})\\n`;
        });
        
        const choice = prompt(selection + '\\nEnter the number of the character to load:');
        const index = parseInt(choice) - 1;
        
        if (index >= 0 && index < savedCharacters.length) {
          loadCharacterData(savedCharacters[index].character);
          alert(`Character "${savedCharacters[index].character.name}" loaded successfully!`);
        }
        
      } catch (error) {
        console.error('❌ Failed to load character:', error);
        alert('Failed to load character. Please try again.');
      }
    }
    
    // Load character data into the interface
    function loadCharacterData(characterData) {
      if (!characterEngine) return;
      
      try {
        // Update character engine
        characterEngine.currentCharacter = characterData;
        characterEngine.updateUI();
        
        // Load background and notes data
        if (characterData.backstory) document.getElementById('characterBackstory').value = characterData.backstory;
        if (characterData.personalityTraits) document.getElementById('personalityTraits').value = characterData.personalityTraits;
        if (characterData.ideals) document.getElementById('characterIdeals').value = characterData.ideals;
        if (characterData.languages) document.getElementById('knownLanguages').value = characterData.languages;
        if (characterData.weaponProficiencies) document.getElementById('weaponProficiencies').value = characterData.weaponProficiencies;
        if (characterData.campaignNotes) document.getElementById('campaignNotes').value = characterData.campaignNotes;
        
        // Update spell slots display
        updateSpellSlotsDisplay();
        
        // Update all calculated fields
        updateCharacterStats();
        
      } catch (error) {
        console.error('❌ Failed to load character data into interface:', error);
      }
    }
    
    // Export character as PDF (placeholder)
    function exportCharacterPDF() {
      alert('PDF export feature coming soon! For now, use your browser\'s Print function on this page.');
    }

    // Make functions available globally for debugging
    window.characterSheet = {
      // Core character functions
      updateCharacterStats,
      updateArmorClass,
      updateInitiative,
      updateSavingThrows,
      updateSkills,
      calculateModifier,
      showPage,
      
      // Enhanced D&D 3.5 functions
      updateStatsWithEnhancedEngine,
      updateArmorClassEnhanced,
      updateInitiativeEnhanced,
      updateSavingThrowsEnhanced,
      
      // Spell management functions
      updateSpellSlotsDisplay,
      searchSpells,
      displaySpellSearchResults,
      showSpellDetails,
      
      // Character management functions
      saveCharacter,
      loadCharacter,
      loadCharacterData,
      exportCharacterPDF,
      
      // System references
      characterEngine: () => characterEngine
    };
  </script>
</body>

</html>