<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RulzLawyer Character System Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
    }

    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
    }

    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    .log {
      background-color: #f8f9fa;
      padding: 10px;
      font-family: monospace;
      margin: 10px 0;
    }
  </style>
</head>

<body>
  <h1>🎲 RulzLawyer Character System Test</h1>

  <div id="moduleLoadingStatus" class="test-section">
    <h2>Module Loading Status</h2>
    <div id="moduleLog" class="log"></div>
  </div>

  <div id="initializationStatus" class="test-section">
    <h2>Character System Initialization</h2>
    <div id="initLog" class="log"></div>
  </div>

  <div id="functionalityTest" class="test-section">
    <h2>Basic Functionality Test</h2>
    <div id="funcLog" class="log"></div>
  </div>

  <!-- Load all required modules -->
  <script src="code-repository/src/dice-engine.js"></script>
  <script src="code-repository/src/random-tables-engine.js"></script>
  <script src="code-repository/src/data-manager.js"></script>
  <script src="code-repository/src/calculation-engine.js"></script>
  <script src="code-repository/src/system-integration.js"></script>
  <script src="code-repository/src/enhanced-character-engine.js"></script>

  <script>
    const moduleLog = document.getElementById('moduleLog');
    const initLog = document.getElementById('initLog');
    const funcLog = document.getElementById('funcLog');

    function log(element, message, isError = false) {
      const timestamp = new Date().toLocaleTimeString();
      const color = isError ? 'red' : 'black';
      element.innerHTML += `<span style="color: ${color};">[${timestamp}] ${message}</span><br>`;
      console.log(message);
    }

    // Test 1: Check if all modules loaded
    log(moduleLog, '🔍 Checking module availability...');

    const modules = [
      { name: 'DiceEngine', obj: window.DiceEngine },
      { name: 'RandomTablesEngine', obj: window.RandomTablesEngine },
      { name: 'DnDDataManager', obj: window.DnDDataManager },
      { name: 'dndDataManager', obj: window.dndDataManager },
      { name: 'DnDCalculationEngine', obj: window.DnDCalculationEngine },
      { name: 'DnDSystemIntegration', obj: window.DnDSystemIntegration },
      { name: 'RulzLawyerCharacterEngine', obj: window.RulzLawyerCharacterEngine },
      { name: 'rulzLawyerEngine', obj: window.rulzLawyerEngine }
    ];

    let allModulesLoaded = true;
    modules.forEach(module => {
      if (module.obj) {
        log(moduleLog, `✅ ${module.name} loaded successfully`);
      } else {
        log(moduleLog, `❌ ${module.name} not found`, true);
        allModulesLoaded = false;
      }
    });

    document.getElementById('moduleLoadingStatus').className =
      allModulesLoaded ? 'test-section success' : 'test-section error';

    // Test 2: Initialize character system
    async function testInitialization() {
      log(initLog, '🎲 Starting character system initialization...');

      try {
        if (!window.rulzLawyerEngine) {
          throw new Error('RulzLawyer engine not available');
        }

        await window.rulzLawyerEngine.initialize();

        log(initLog, '✅ Character system initialized successfully');
        log(initLog, `📊 Engine status: ${window.rulzLawyerEngine.isInitialized ? 'Ready' : 'Not Ready'}`);

        document.getElementById('initializationStatus').className = 'test-section success';

        // Run functionality tests
        await testFunctionality();

      } catch (error) {
        log(initLog, `❌ Initialization failed: ${error.message}`, true);
        document.getElementById('initializationStatus').className = 'test-section error';
      }
    }

    // Test 3: Basic functionality
    async function testFunctionality() {
      log(funcLog, '🧪 Testing basic functionality...');

      try {
        const engine = window.rulzLawyerEngine;

        // Test character creation
        const character = engine.getCharacter();
        if (character) {
          log(funcLog, `✅ Character object available: ${character.name || 'Unnamed'}`);
        } else {
          log(funcLog, '⚠️ No character object found');
        }

        // Test data manager
        if (engine.dataManager) {
          const races = engine.dataManager.getRaces();
          log(funcLog, `✅ Data manager working - ${races.length} races loaded`);
        } else {
          log(funcLog, '❌ Data manager not available', true);
        }

        // Test calculation engine
        if (engine.calculationEngine) {
          const mod = engine.calculationEngine.calculateAbilityModifier(15);
          log(funcLog, `✅ Calculation engine working - Ability modifier for 15: ${mod}`);
        } else {
          log(funcLog, '❌ Calculation engine not available', true);
        }

        log(funcLog, '🎯 All functionality tests completed');
        document.getElementById('functionalityTest').className = 'test-section success';

      } catch (error) {
        log(funcLog, `❌ Functionality test failed: ${error.message}`, true);
        document.getElementById('functionalityTest').className = 'test-section error';
      }
    }

    // Start testing when page loads
    window.addEventListener('load', () => {
      setTimeout(testInitialization, 1000); // Give modules time to load
    });
  </script>
</body>

</html>